<!doctype html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demande de Messe - R√©daction d'Intention</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Quelle est votre intention de pri√®re ?</h1>
            <p>
                Choisissez une cat√©gorie et nous vous aiderons √† formuler votre
                intention
            </p>

            <div class="progress-bar">
                <div class="progress-step active">1</div>
                <div class="progress-step">2</div>
                <div class="progress-step">3</div>
                <div class="progress-step">4</div>
                <div class="progress-step">5</div>
            </div>
        </div>

        <div class="content">
            <!-- √âtape 1: S√©lection de la cat√©gorie -->
            <div class="step active" id="step-category">
                <h2>Choisissez une cat√©gorie</h2>
                <p>
                    S√©lectionnez la cat√©gorie qui correspond le mieux √† votre intention
                </p>

                <!-- Barre de recherche -->
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" id="search-input"
                        placeholder="Rechercher une intention (d√©funt, sant√©, voyage...)" />
                    <div class="search-results" id="search-results"></div>
                </div>

                <div class="quick-search-title">Ou parcourir par cat√©gorie</div>

                <div class="categories-grid">
                    <div class="category-card" data-category="defunt">
                        <div class="category-icon">‚õ™</div>
                        <div class="category-name">D√©funts</div>
                    </div>
                    <div class="category-card" data-category="sante">
                        <div class="category-icon">‚ù§Ô∏è</div>
                        <div class="category-name">Sant√©</div>
                    </div>
                    <div class="category-card" data-category="famille">
                        <div class="category-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                        <div class="category-name">Famille</div>
                    </div>
                    <div class="category-card" data-category="voyage">
                        <div class="category-icon">‚úàÔ∏è</div>
                        <div class="category-name">Voyage</div>
                    </div>
                    <div class="category-card" data-category="action-de-grace">
                        <div class="category-icon">üôè</div>
                        <div class="category-name">Action de gr√¢ce</div>
                    </div>
                    <div class="category-card" data-category="travail">
                        <div class="category-icon">üíº</div>
                        <div class="category-name">Travail</div>
                    </div>
                    <div class="category-card" data-category="reussite">
                        <div class="category-icon">üéì</div>
                        <div class="category-name">R√©ussite</div>
                    </div>
                    <div class="category-card" data-category="spiritualite">
                        <div class="category-icon">‚õ™</div>
                        <div class="category-name">Spiritualit√©</div>
                    </div>
                    <div class="category-card" data-category="monde">
                        <div class="category-icon">üåç</div>
                        <div class="category-name">Monde & Soci√©t√©</div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" disabled>
                        <i class="fas fa-arrow-left"></i> Retour
                    </button>
                    <button class="btn btn-primary" id="btn-next-category" disabled>
                        Suivant <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- √âtape 2: S√©lection de la sous-cat√©gorie -->
            <div class="step" id="step-subcategory">
                <h2>Pr√©cisez votre intention</h2>
                <p>S√©lectionnez une sous-cat√©gorie pour affiner votre demande</p>

                <div class="selected-category">
                    <i class="fas fa-folder-open"></i>
                    <span id="selected-category-name">Cat√©gorie s√©lectionn√©e</span>
                </div>

                <div class="subcategories-grid" id="subcategories-container">
                    <!-- Les sous-cat√©gories seront inject√©es dynamiquement -->
                </div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" id="btn-back-category">
                        <i class="fas fa-arrow-left"></i> Retour
                    </button>
                    <button class="btn btn-primary" id="btn-next-subcategory" disabled>
                        Suivant <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- √âtape 3: R√©daction de l'intention -->
            <div class="step" id="step-redaction">
                <h2>R√©digez votre intention</h2>
                <p>Nous avons pr√©par√© une suggestion que vous pouvez personnaliser</p>

                <div class="selected-category">
                    <i class="fas fa-folder-open"></i>
                    <span id="final-category-name">Cat√©gorie > Sous-cat√©gorie</span>
                </div>

                <div class="input-section">
                    <div class="input-toggle">
                        <div class="toggle-option active" id="toggle-ai">
                            Aide √† la r√©daction (IA)
                        </div>
                        <div class="toggle-option" id="toggle-manual">
                            R√©diger moi-m√™me
                        </div>
                    </div>

                    <div id="ai-assist-section">
                        <div class="suggestion-box">
                            <div class="suggestion-header">
                                <div class="suggestion-title">Suggestion</div>
                                <button class="regenerate-btn">
                                    <i class="fas fa-rotate"></i> R√©g√©n√©rer
                                </button>
                            </div>
                            <div class="suggestion-text" id="suggestion-text">
                                Veuillez s√©lectionner une sous-cat√©gorie pour g√©n√©rer une
                                suggestion.
                            </div>
                        </div>
                    </div>

                    <div id="manual-input-section" style="display: none">
                        <textarea placeholder="R√©digez votre intention de messe ici..." id="manual-textarea"></textarea>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" id="btn-back-subcategory">
                        <i class="fas fa-arrow-left"></i> Retour
                    </button>
                    <button class="btn btn-primary" id="btn-continue" disabled>
                        Continuer <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Script sp√©cifique √† la page index.html
        document.addEventListener("DOMContentLoaded", function () {
            // √âl√©ments DOM
            const steps = document.querySelectorAll(".step");
            const categoryCards = document.querySelectorAll(".category-card");
            const btnNextCategory = document.getElementById("btn-next-category");
            const btnNextSubcategory = document.getElementById(
                "btn-next-subcategory"
            );
            const btnBackCategory = document.getElementById("btn-back-category");
            const btnBackSubcategory = document.getElementById(
                "btn-back-subcategory"
            );
            const btnContinue = document.getElementById("btn-continue");
            const selectedCategoryName = document.getElementById(
                "selected-category-name"
            );
            const finalCategoryName = document.getElementById(
                "final-category-name"
            );
            const subcategoriesContainer = document.getElementById(
                "subcategories-container"
            );
            const toggleAi = document.getElementById("toggle-ai");
            const toggleManual = document.getElementById("toggle-manual");
            const aiAssistSection = document.getElementById("ai-assist-section");
            const manualInputSection = document.getElementById(
                "manual-input-section"
            );
            const regenerateButton = document.querySelector(".regenerate-btn");
            const suggestionText = document.getElementById("suggestion-text");
            const manualTextarea = document.getElementById("manual-textarea");
            const searchInput = document.getElementById("search-input");
            const searchResults = document.getElementById("search-results");

            // Variables d'√©tat
            let currentStep = 0;
            let selectedCategory = null;
            let selectedSubcategory = null;
            let toggle = null;

            // Initialisation
            initApp();

            function initApp() {
                // Gestion des √©v√©nements
                setupEventListeners();

                // Afficher la premi√®re √©tape
                showStep(0);

                // Charger les donn√©es sauvegard√©es si elles existent
                const savedCategory = localStorage.getItem("selectedCategory");
                const savedSubcategory = localStorage.getItem("selectedSubcategory");
                const savedIntention = localStorage.getItem("intentionText");
                const toggle = localStorage.getItem("toggle");

                if (savedCategory) {
                    selectCategory(savedCategory);

                    if (savedSubcategory) {
                        // Si on a une sous-cat√©gorie, passer √† l'√©tape de r√©daction
                        selectedSubcategory = savedSubcategory;
                        finalCategoryName.textContent = `${categories[savedCategory].name} > ${categories[savedCategory].subcategories[savedSubcategory]}`;

                        if (savedIntention) {
                            suggestionText.textContent = savedIntention;
                            manualTextarea.value = savedIntention;
                        }

                        showStep(2);
                    } else {
                        // Sinon, passer √† l'√©tape de s√©lection de sous-cat√©gorie
                        showStep(1);
                    }
                }

                if (toggle === "manual") {
                    toggleManual.click();
                } else {
                    toggleAi.click();
                }
            }

            function setupEventListeners() {
                // Navigation entre les √©tapes
                btnNextCategory.addEventListener("click", () => showStep(1));
                btnNextSubcategory.addEventListener("click", () => showStep(2));
                btnBackCategory.addEventListener("click", () => showStep(0));
                btnBackSubcategory.addEventListener("click", () => showStep(1));

                // S√©lection des cat√©gories
                categoryCards.forEach((card) => {
                    card.addEventListener("click", function () {
                        selectCategory(this.dataset.category);
                    });
                });

                // Basculer entre l'aide IA et la r√©daction manuelle
                toggleAi.addEventListener("click", function () {
                    toggleAi.classList.add("active");
                    toggleManual.classList.remove("active");
                    aiAssistSection.style.display = "block";
                    manualInputSection.style.display = "none";
                    localStorage.setItem("toggle", "ai");
                    updateContinueButton();
                });

                toggleManual.addEventListener("click", function () {
                    toggleManual.classList.add("active");
                    toggleAi.classList.remove("active");
                    manualInputSection.style.display = "block";
                    aiAssistSection.style.display = "none";
                    localStorage.setItem("toggle", "manual");
                    updateContinueButton();
                });

                // R√©g√©n√©rer une suggestion
                regenerateButton.addEventListener("click", regenerateSuggestion);

                // √âcouter les modifications dans le textarea
                manualTextarea.addEventListener("input", updateContinueButton);

                // Recherche
                searchInput.addEventListener("input", handleSearch);
                searchInput.addEventListener("focus", handleSearch);

                // Navigation vers la page des dates
                btnContinue.addEventListener("click", function () {
                    // Sauvegarder l'intention
                    if (toggleAi.classList.contains("active")) {
                        localStorage.setItem("intentionText", suggestionText.textContent);

                    } else {
                        localStorage.setItem("intentionText", manualTextarea.value);
                    }

                    // Rediriger vers la page des dates
                    window.location.href = "dates.html";
                });
            }

            function showStep(stepIndex) {
                // Masquer toutes les √©tapes
                steps.forEach((step) => step.classList.remove("active"));

                // Afficher l'√©tape demand√©e
                steps[stepIndex].classList.add("active");

                currentStep = stepIndex;

                // Actions sp√©cifiques √† chaque √©tape
                if (stepIndex === 1 && selectedCategory) {
                    displaySubcategories();
                } else if (stepIndex === 2 && selectedSubcategory && toggle === "ai") {
                    generateSuggestion();
                }
            }

            function selectCategory(categoryId) {
                // D√©s√©lectionner toutes les cat√©gories
                categoryCards.forEach((card) => card.classList.remove("selected"));

                // S√©lectionner la cat√©gorie choisie
                const selectedCard = document.querySelector(
                    `.category-card[data-category="${categoryId}"]`
                );
                selectedCard.classList.add("selected");

                // Mettre √† jour la cat√©gorie s√©lectionn√©e
                selectedCategory = categoryId;
                selectedCategoryName.textContent = categories[categoryId].name;
                finalCategoryName.textContent = `${categories[categoryId].name} > `;

                // Sauvegarder la s√©lection
                localStorage.setItem("selectedCategory", categoryId);

                // Activer le bouton Suivant
                btnNextCategory.disabled = false;
            }

            function displaySubcategories() {
                // Vider le conteneur de sous-cat√©gories
                subcategoriesContainer.innerHTML = "";

                // Ajouter les sous-cat√©gories correspondantes
                for (const [id, name] of Object.entries(
                    categories[selectedCategory].subcategories
                )) {
                    const subcategoryCard = document.createElement("div");
                    subcategoryCard.className = "subcategory-card";
                    subcategoryCard.dataset.subcategory = id;

                    subcategoryCard.innerHTML = `
                        <div class="subcategory-icon">${categories[selectedCategory].icon}</div>
                        <div class="subcategory-name">${name}</div>
                    `;

                    subcategoryCard.addEventListener("click", function () {
                        selectSubcategory(this.dataset.subcategory);
                    });

                    subcategoriesContainer.appendChild(subcategoryCard);
                }

                if (selectedSubcategory) {
                    // Si une sous-cat√©gorie est d√©j√† s√©lectionn√©e, la s√©lectionner √† nouveau
                    selectSubcategory(selectedSubcategory);
                }
            }

            function selectSubcategory(subcategoryId) {
                // D√©s√©lectionner toutes les sous-cat√©gories
                const subcategoryCards =
                    document.querySelectorAll(".subcategory-card");
                subcategoryCards.forEach((card) => card.classList.remove("selected"));

                // S√©lectionner la sous-cat√©gorie choisie
                const selectedCard = document.querySelector(
                    `.subcategory-card[data-subcategory="${subcategoryId}"]`
                );

                if (selectedCard) {
                    selectedCard.classList.add("selected");
                }

                // Mettre √† jour la sous-cat√©gorie s√©lectionn√©e
                selectedSubcategory = subcategoryId;
                finalCategoryName.textContent = `${categories[selectedCategory].name} > ${categories[selectedCategory].subcategories[subcategoryId]}`;

                // Sauvegarder la s√©lection
                localStorage.setItem("selectedSubcategory", subcategoryId);

                // Activer le bouton Suivant
                btnNextSubcategory.disabled = false;
            }

            function generateSuggestion() {
                if (selectedSubcategory && suggestions[selectedSubcategory]) {
                    suggestionText.textContent = suggestions[selectedSubcategory];
                } else {
                    suggestionText.textContent =
                        "Pour l'intention de [pr√©cisez], que Dieu accorde ses gr√¢ces selon sa volont√© divine.";
                }

                // Pr√©-remplir le textarea manuel avec la suggestion
                manualTextarea.value = suggestionText.textContent;

                updateContinueButton();
            }

            function regenerateSuggestion() {
                if (selectedSubcategory) {
                    // Animation simple pour simuler le chargement
                    suggestionText.textContent = "G√©n√©ration en cours...";

                    // Simuler un d√©lai de g√©n√©ration
                    setTimeout(() => {
                        generateSuggestion();
                    }, 500);
                }
            }

            function updateContinueButton() {
                if (toggleAi.classList.contains("active")) {
                    btnContinue.disabled = !selectedSubcategory;
                } else {
                    btnContinue.disabled = !manualTextarea.value.trim();
                }
            }

            function handleSearch() {
                const query = searchInput.value.toLowerCase().trim();

                if (query.length < 2) {
                    searchResults.style.display = "none";
                    return;
                }

                // Filtrer les r√©sultats
                const results = searchIndex.filter(
                    (item) =>
                        item.name.toLowerCase().includes(query) ||
                        item.categoryName.toLowerCase().includes(query)
                );

                displaySearchResults(results);
            }

            function displaySearchResults(results) {
                searchResults.innerHTML = "";

                if (results.length === 0) {
                    const noResult = document.createElement("div");
                    noResult.className = "search-result-item";
                    noResult.textContent = "Aucun r√©sultat trouv√©";
                    searchResults.appendChild(noResult);
                } else {
                    results.forEach((result) => {
                        const resultItem = document.createElement("div");
                        resultItem.className = "search-result-item";
                        resultItem.innerHTML = `
                            <div>${result.icon}</div>
                            <div>${result.name}</div>
                            <div class="search-result-category">${result.categoryName}</div>
                        `;

                        resultItem.addEventListener("click", () => {
                            // S√©lectionner directement la sous-cat√©gorie
                            selectedCategory = result.categoryId;
                            selectedSubcategory = result.id;
                            finalCategoryName.textContent = `${result.categoryName} > ${result.name}`;

                            // Sauvegarder les s√©lections
                            localStorage.setItem("selectedCategory", result.categoryId);
                            localStorage.setItem("selectedSubcategory", result.id);

                            // G√©n√©rer la suggestion
                            generateSuggestion();

                            // Passer directement √† l'√©tape 3
                            showStep(2);

                            // Cacher les r√©sultats de recherche
                            searchResults.style.display = "none";
                            searchInput.value = "";
                        });

                        searchResults.appendChild(resultItem);
                    });
                }

                searchResults.style.display = "block";
            }
        });
    </script>
</body>

</html>